<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>South Fade Dashboard</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<style>
:root {
  --primary: #fcd535;
  --primary-dark: #e6c12f;
  --bg-primary: #0a0a0a;
  --bg-secondary: #1a1a1a;
  --bg-card: #2a2a2a;
  --text-primary: #ffffff;
  --text-secondary: #b8b8b8;
  --accent: #ffdd35;
  --glass: rgba(255, 255, 255, 0.1);
  --border-glass: 1px solid rgba(255, 255, 255, 0.18);
  --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

body {
  font-family: 'Inter', sans-serif;
  background: var(--bg-primary);
  color: var(--text-primary);
  margin: 0;
  padding: 0;
}

/* Navbar */
header {
  background: rgba(10,10,10,0.9);
  padding: 1rem 2rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: var(--border-glass);
  backdrop-filter: blur(20px);
}
header img {
  height: 50px;
}
header a {
  color: var(--primary);
  text-decoration: none;
  font-weight: 600;
}

/* Dashboard Layout */
main {
  max-width: 1200px;
  margin: 3rem auto;
  padding: 1rem;
}

h1 {
  color: var(--primary);
  font-size: 2rem;
  margin-bottom: 2rem;
  text-align: center;
}

.dashboard-grid {
  display: grid;
  grid-template-columns: 2fr 1fr;
  gap: 2rem;
}

/* Table */
.table-container {
  background: var(--glass);
  border: var(--border-glass);
  border-radius: 16px;
  box-shadow: var(--shadow);
  overflow: hidden;
  backdrop-filter: blur(16px);
}

table {
  width: 100%;
  border-collapse: collapse;
}

th, td {
  padding: 1rem;
  border-bottom: 1px solid rgba(255,255,255,0.1);
  text-align: left;
}

th {
  color: var(--primary);
  font-size: 0.9rem;
  text-transform: uppercase;
}

.status {
  padding: 0.3rem 0.8rem;
  border-radius: 8px;
  font-weight: 600;
  font-size: 0.85rem;
  background: rgba(255,255,255,0.1);
}
.status.Pending { color: #fcd535; }
.status.Confirmed { color: #10b981; }
.status.Cancelled { color: #ef4444; }

/* Chart */
.chart-card {
  background: var(--glass);
  border: var(--border-glass);
  border-radius: 16px;
  box-shadow: var(--shadow);
  padding: 1.5rem;
  text-align: center;
  backdrop-filter: blur(16px);
}

.chart-card h2 {
  color: var(--primary);
  margin-bottom: 1rem;
}

/* Toast */
.toast {
  position: fixed;
  top: 2rem;
  right: 2rem;
  background: var(--glass);
  border: var(--border-glass);
  border-radius: 12px;
  backdrop-filter: blur(20px);
  color: var(--text-primary);
  padding: 1rem 1.5rem;
  opacity: 0;
  transform: translateX(400px);
  transition: all 0.3s ease;
}
.toast.show {
  opacity: 1;
  transform: translateX(0);
}

/* Responsive */
@media(max-width: 900px) {
  .dashboard-grid {
    grid-template-columns: 1fr;
  }
}
</style>
</head>
<body>

<header>
  <a href="https://south-fade.com">
    <img src="./South-fade.png" alt="South Fade Logo">
  </a>
  <a href="https://south-fade.com">‚Üê Back to Home</a>
</header>

<main>
  <h1>Bookings Dashboard</h1>

  <div class="dashboard-grid">
    <!-- Table -->
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>Name</th>
            <th>Service</th>
            <th>Subservice</th>
            <th>Date</th>
            <th>Time</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="bookingsBody">
          <tr><td colspan="6">Loading bookings...</td></tr>
        </tbody>
      </table>
    </div>

    <!-- Chart -->
    <div class="chart-card">
      <h2>Most Booked Services</h2>
      <canvas id="serviceChart"></canvas>
    </div>
  </div>
</main>

<div class="toast" id="toast"></div>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbw4DIGCxGzC7OAXg3-DezQEaF6QqmwCofE-8REldc95FmAPmY-3AN3pG2gm6JhGTg13/exec";
let chart;

function showToast(msg) {
  const t = document.getElementById("toast");
  t.textContent = msg;
  t.classList.add("show");
  setTimeout(() => t.classList.remove("show"), 3000);
}

async function fetchBookings() {
  try {
    const res = await fetch(WEB_APP_URL + "?action=getBookings");
    const json = await res.json();
    if (json.status !== "success") throw new Error(json.message);
    return json.data;
  } catch (err) {
    console.error(err);
    showToast("Failed to load data");
    return [];
  }
}

function renderBookings(data) {
  const tbody = document.getElementById("bookingsBody");
  if (!data.length) {
    tbody.innerHTML = `<tr><td colspan="6">No bookings found</td></tr>`;
    return;
  }

  tbody.innerHTML = data.slice(-10).reverse().map(b => `
    <tr>
      <td>${b.Name || ""}</td>
      <td>${b.Service || ""}</td>
      <td>${b.Subservice || ""}</td>
      <td>${b.Date || ""}</td>
      <td>${b.Time || ""}</td>
      <td><span class="status ${b.Status || "Pending"}">${b.Status || "Pending"}</span></td>
    </tr>
  `).join("");
}

function renderChart(data) {
  const ctx = document.getElementById("serviceChart");
  const serviceCount = {};
  data.forEach(b => {
    const s = b.Service || "Unknown";
    serviceCount[s] = (serviceCount[s] || 0) + 1;
  });
  const labels = Object.keys(serviceCount);
  const values = Object.values(serviceCount);
  if (chart) chart.destroy();
  chart = new Chart(ctx, {
    type: "bar",
    data: {
      labels,
      datasets: [{
        label: "Bookings",
        data: values,
        backgroundColor: "rgba(252,213,53,0.7)",
        borderColor: "#fcd535",
        borderWidth: 2
      }]
    },
    options: {
      plugins: { legend: { display: false } },
      scales: {
        x: { ticks: { color: "#fff" }, grid: { color: "rgba(255,255,255,0.1)" } },
        y: { ticks: { color: "#fff" }, grid: { color: "rgba(255,255,255,0.1)" } }
      }
    }
  });
}

async function initDashboard() {
  const data = await fetchBookings();
  renderBookings(data);
  renderChart(data);
  showToast("Dashboard updated at " + new Date().toLocaleTimeString());
}

// initialize on load
document.addEventListener("DOMContentLoaded", initDashboard);

// auto-refresh every 20 minutes
setInterval(initDashboard, 1200000);
</script>

</body>
</html>
