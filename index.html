<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>South Fade Admin Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family:"Helvetica Neue",Arial,sans-serif;
      background:#0a0a0a; color:#f0f0f0;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    header {
      display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap;
      background:linear-gradient(135deg,#000,#1a1a1a);
      color:#FFD700; padding:18px 22px; border-bottom:1px solid #222;
      box-shadow:0 4px 15px rgba(0,0,0,0.5);
      position:sticky; top:0; z-index:50;
    }
    .brand{ display:flex; gap:10px; align-items:center; }
    .brand h1{ font-size:1.2rem; font-weight:800; }
    .brand p{ font-size:0.85rem; color:#aaa; }
    .btn{ padding:10px 14px; border:none; border-radius:8px; cursor:pointer; font-weight:700; transition:all .2s; }
    .btn-primary{ background:#FFD700; color:#000; }
    .btn-primary:hover{ background:#e6c200; transform:translateY(-2px); }
    .btn-secondary{ background:#333; color:#FFD700; border:1px solid #FFD700; margin-left:8px; }
    .btn-secondary:hover{ background:#444; }
    .container{ max-width:1400px; margin:26px auto; padding:0 20px 80px; }

    .stats{ display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:18px; margin-bottom:22px; }
    .stat{ background:#121212; padding:18px; border-radius:10px; border-left:4px solid #FFD700; box-shadow:0 4px 12px rgba(0,0,0,0.35); }
    .stat h3{ color:#bbb; font-size:0.8rem; text-transform:uppercase; margin-bottom:8px; }
    .stat .num{ font-size:2.1rem; color:#FFD700; font-weight:800; }
    .stat .lbl{ color:#888; font-size:0.9rem; }

    .table-box{ background:#121212; border-radius:10px; overflow:hidden; border:1px solid #222; box-shadow:0 4px 12px rgba(0,0,0,0.35); }
    .table-header{ display:flex; justify-content:space-between; align-items:center; gap:10px; padding:16px 18px; background:#161616; border-bottom:1px solid #222; flex-wrap:wrap; }
    .table-header h2{ color:#FFD700; font-size:1rem; font-weight:700; }
    .search{ position:relative; width:100%; max-width:320px; }
    .search input{ width:100%; padding:10px 40px 10px 14px; border-radius:25px; border:1px solid #333; background:#1a1a1a; color:#fff; }
    .search i{ position:absolute; right:12px; top:50%; transform:translateY(-50%); color:#777; }

    .table-scroll{ overflow-x:auto; }
    table{ width:100%; border-collapse:collapse; min-width:900px; }
    th, td{ padding:12px 14px; border-bottom:1px solid #222; text-align:left; }
    th{ background:#1a1a1a; color:#FFD700; font-size:0.78rem; text-transform:uppercase; }
    td{ color:#ddd; font-size:0.95rem; }

    .badge{ display:inline-block; padding:5px 10px; border-radius:18px; font-weight:700; text-transform:uppercase; font-size:0.78rem; }
    .badge-confirmed{ background:rgba(40,167,69,0.12); color:#56d678; border:1px solid #2b7a44; }
    .badge-cancelled{ background:rgba(220,53,69,0.12); color:#ff6b7f; border:1px solid #8a2a33; }
    .badge-pending{ background:rgba(255,215,0,0.08); color:#FFD700; border:1px solid #aa9000; }

    .btn-view{ background:#3498db; color:#fff; padding:6px 12px; border-radius:6px; border:none; cursor:pointer; font-weight:700; margin-right:4px; }
    .btn-view:hover{ background:#2980b9; }
    .btn-cancel{ background:#e74c3c; color:#fff; padding:6px 12px; border-radius:6px; border:none; cursor:pointer; font-weight:700; }
    .btn-cancel:hover{ background:#c0392b; }

    .loading, .no-data{ text-align:center; padding:36px; color:#888; }
    .spinner{ border:3px solid rgba(255,215,0,0.18); border-top:3px solid #FFD700; border-radius:50%; width:30px; height:30px; animation:spin 1s linear infinite; margin:10px auto 12px; }
    @keyframes spin{ 0%{transform:rotate(0)}100%{transform:rotate(360deg)} }

    .modal{ display:none; position:fixed; inset:0; background:rgba(0,0,0,0.85); z-index:1000; align-items:center; justify-content:center; padding:18px; }
    .modal.active{ display:flex; }
    .modal-content{ background:#121212; width:100%; max-width:640px; border-radius:12px; padding:22px; border:1px solid #333; max-height:92vh; overflow-y:auto; }
    .modal-header{ display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #222; padding-bottom:10px; margin-bottom:16px; }
    .modal-header h3{ color:#FFD700; }
    .modal-close{ background:none; border:none; color:#888; font-size:1.6rem; cursor:pointer; }
    .modal-close:hover{ color:#FFD700; }
    
    .form-group{ margin-bottom:16px; }
    .form-group label{ display:block; color:#FFD700; font-weight:600; margin-bottom:6px; font-size:0.9rem; }
    .form-group input, .form-group select, .form-group textarea{ 
      width:100%; padding:10px; border-radius:6px; border:1px solid #333; 
      background:#1a1a1a; color:#fff; font-size:0.95rem; 
    }
    .form-row{ display:grid; grid-template-columns:1fr 1fr; gap:12px; }
    @media(max-width:640px){ .form-row{ grid-template-columns:1fr; } }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <h1><i class="fas fa-cut"></i> South Fade Admin</h1>
      <p>Dashboard</p>
    </div>
    <div>
      <button id="openAddBtn" class="btn btn-primary"><i class="fas fa-plus"></i> Add Booking</button>
      <button id="refreshBtn" class="btn btn-secondary"><i class="fas fa-sync"></i> Refresh</button>
    </div>
  </header>

  <main class="container">
    <section class="stats">
      <div class="stat"><h3>Today's Bookings</h3><div class="num" id="todayCount">0</div><div class="lbl">Appointments</div></div>
      <div class="stat"><h3>Total Revenue</h3><div class="num" id="revenue">£0.00</div><div class="lbl">Confirmed only</div></div>
      <div class="stat"><h3>Total Bookings</h3><div class="num" id="totalCount">0</div><div class="lbl">All time</div></div>
    </section>

    <section class="table-box">
      <div class="table-header">
        <h2><i class="fas fa-calendar-alt"></i> All Bookings</h2>
        <div class="search">
          <input id="searchBox" type="text" placeholder="Search name, email..." />
          <i class="fas fa-search"></i>
        </div>
      </div>

      <div id="loading" class="loading">
        <div class="spinner"></div>
        <p>Loading bookings…</p>
      </div>

      <div id="tableContainer" style="display:none">
        <div class="table-scroll">
          <table>
            <thead>
              <tr>
                <th>Customer</th><th>Contact</th><th>Date</th><th>Time</th><th>Barber</th><th>Service</th><th>Price</th><th>Status</th><th>Actions</th>
              </tr>
            </thead>
            <tbody id="tableBody"></tbody>
          </table>
        </div>
      </div>

      <div id="noData" class="no-data" style="display:none">
        <i class="fas fa-inbox" style="font-size:3rem;margin-bottom:8px;"></i>
        <p>No bookings found</p>
      </div>
    </section>
  </main>

  <!-- View Modal -->
  <div id="viewModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3><i class="fas fa-info-circle"></i> Booking Details</h3>
        <button class="modal-close" onclick="closeViewModal()">&times;</button>
      </div>
      <div id="viewModalBody" style="color:#ddd"></div>
    </div>
  </div>

  <!-- Add Booking Modal -->
  <div id="addModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3><i class="fas fa-plus-circle"></i> Add New Booking</h3>
        <button class="modal-close" onclick="closeAddModal()">&times;</button>
      </div>
      <form id="addBookingForm">
        <div class="form-group">
          <label>Customer Name *</label>
          <input type="text" name="customer_name" required>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Email *</label>
            <input type="email" name="customer_email" required>
          </div>
          <div class="form-group">
            <label>Phone *</label>
            <input type="tel" name="customer_phone" required>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Barber *</label>
            <select name="barber" required>
              <option value="">Select barber</option>
              <option value="Moh">Moh</option>
              <option value="Alex">Alex</option>
              <option value="Yass">Yass</option>
              <option value="Ali">Ali</option>
            </select>
          </div>
          <div class="form-group">
            <label>Service *</label>
            <select name="service" id="addService" required>
              <option value="">Select service</option>
              <option value="Buzz cut Fade" data-price="24">Buzz cut Fade — £24</option>
              <option value="Wash & cut" data-price="25">Wash & cut — £25</option>
              <option value="Skin Fade" data-price="27">Skin Fade — £27</option>
              <option value="Scissor Cut" data-price="27">Scissor Cut — £27</option>
              <option value="Restyle Cut" data-price="30">Restyle Cut — £30</option>
              <option value="Beard Trim Clipper" data-price="17">Beard Trim Clipper — £17</option>
              <option value="Beard Trim + Hot Towel" data-price="20">Beard Trim + Hot Towel — £20</option>
              <option value="Facial" data-price="20">Facial — £20</option>
              <option value="Face Mask" data-price="10">Face Mask — £10</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Date *</label>
            <input type="date" name="booking_date" required>
          </div>
          <div class="form-group">
            <label>Time *</label>
            <input type="time" name="booking_time" required>
          </div>
        </div>
        <div class="form-group">
          <label>Notes</label>
          <textarea name="notes" rows="2"></textarea>
        </div>
        <button type="submit" class="btn btn-primary" style="width:100%;margin-top:10px">
          <i class="fas fa-check"></i> Create Booking
        </button>
      </form>
    </div>
  </div>

  <!-- Supabase SDK -->